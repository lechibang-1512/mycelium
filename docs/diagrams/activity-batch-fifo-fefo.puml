@startuml activity-batch-fifo-fefo
title Activity Diagram: Batch Tracking with FIFO/FEFO Strategies

!include skinparams.puml

|Staff/Admin|
start
:Initiate Sale of Batch-Tracked Product;

|System|
:Determine Picking Strategy;
note right
  The system checks the product's configuration
  to determine whether to use FIFO (First In,
  First Out), FEFO (First Expired, First Out),
  or allow manual batch selection.
end note

:Allocate Stock from Batches;
note right
  Based on the selected strategy, the system
  queries available batches and allocates the
  requested quantity, starting with the oldest
  or soonest-to-expire stock. Expired batches
  are automatically skipped and flagged.
end note

if (Stock Fully Allocated?) then (yes)
  :Confirm and Process Sale;
  note right
    The user confirms the allocation, and the
    system processes the sale. This includes:
    • Updating batch and inventory records
    • Logging all transactions
    • Updating serial numbers if applicable
    • Creating a sales receipt
  end note
  stop
else (no)
  :Handle Stock Shortfall;
  note right
    If the requested quantity cannot be fulfilled,
    the system displays a warning and provides options:
    • Reduce the sale quantity
    • Transfer stock from another location
    • Create a backorder
  end note
  stop
endif

@enduml

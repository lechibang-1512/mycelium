@startuml business-process-password-recovery
title Business Process: Password Recovery & Account Security

!include skinparams.puml

|User|
start
:Request Password Reset;

|System|
:Validate Request and User;
note right
  The system checks for a valid, active user account
  associated with the provided email or username.
  To prevent user enumeration, a generic success
  message is always displayed.
end note

if (User Account Valid?) then (yes)
  :Generate and Send Reset Link;
  note right
    A secure, single-use token is generated,
    stored, and emailed to the user.
    The link is set to expire in 1 hour.
  end note
  
  |User|
  :Click Reset Link in Email;

  |System|
  :Validate Reset Token;

  if (Token Valid and Not Expired?) then (yes)
    :Display New Password Form;
    
    |User|
    :Submit New Password;
    
    |System|
    :Validate and Update Password;
    note right
      The new password is validated against
      strength requirements and password history.
      If valid, it is hashed and stored.
    end note
    
    :Finalize and Notify;
    note right
      All active sessions are invalidated,
      the used token is deleted, and a
      confirmation email is sent to the user.
    end note
    
    :Redirect to Login Page;
    stop

  else (no)
    :Display Token Error;
    note right
      If the token is invalid or expired,
      an error is shown, and the user is
      prompted to restart the process.
    end note
    stop
  endif
  
else (no)
  :Log and Display Generic Message;
  note right
    The system logs the attempt but still
    displays a generic success message
    to prevent user enumeration.
  end note
  stop
endif

@enduml
